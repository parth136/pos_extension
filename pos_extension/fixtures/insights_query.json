[
 {
  "chart": "oh62cn8ca8",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.095,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Company\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": null,\n    \"alias\": \"Referral Company\",\n    \"column\": \"referral_company\",\n    \"expression\": {},\n    \"format\": null,\n    \"granularity\": null,\n    \"label\": \"Referral Company\",\n    \"meta\": null,\n    \"order\": null,\n    \"table\": \"tabCustomer\",\n    \"type\": \"String\"\n   },\n   \"expression\": {},\n   \"operator\": {\n    \"label\": \"is set\",\n    \"value\": \"is_set\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [],\n \"limit\": 100000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-12 10:44:01.507617",
  "limit": 500,
  "modified": "2024-06-12 12:59:30.485515",
  "name": "QRY-0006",
  "result_name": "oh62dbi84l",
  "results_row_count": 2,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Referral Company`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n WHERE `tabCustomer`.referral_company IS NOT NULL\n GROUP BY `tabCustomer`.referral_company\n LIMIT 100000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise Wise Customers",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "rclfdvds5p",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.133,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-10 13:49:08.906602",
  "limit": 500,
  "modified": "2024-06-14 10:22:44.394074",
  "name": "QRY-0029",
  "result_name": "rclgsjn10h",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT COUNT(DISTINCT CASE WHEN tw.customer IS NOT NULL THEN tw.customer END) AS \"Customers Who Bought This Two Week & Last Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Two Week Only\",\n       CONCAT(ROUND((COUNT(DISTINCT CASE WHEN tw.customer IS NOT NULL THEN tw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0)) * 100, 2), '%') AS \"Retention Rate\"\n  FROM (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY\n           AND posting_date < CURDATE() - INTERVAL WEEKDAY(CURDATE()) + 8 DAY\n       ) AS lw\n  LEFT JOIN (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY\n           AND posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON lw.customer = tw.customer",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate SQL Query(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "oj1s81e9g6",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.066,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Franchise Name\",\n   \"column\": \"franchise_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": null,\n    \"alias\": \"Franchise Name\",\n    \"column\": \"franchise_name\",\n    \"expression\": {},\n    \"format\": null,\n    \"granularity\": null,\n    \"label\": \"Franchise Name\",\n    \"meta\": null,\n    \"order\": null,\n    \"table\": \"tabCustomer\",\n    \"type\": \"String\"\n   },\n   \"expression\": {},\n   \"operator\": {\n    \"label\": \"is set\",\n    \"value\": \"is_set\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [],\n \"limit\": 100000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-12 10:44:01.609846",
  "limit": 500,
  "modified": "2024-06-12 12:59:24.092183",
  "name": "QRY-0007",
  "result_name": "oj1t7a97tr",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.franchise_name AS `Franchise Name`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n WHERE `tabCustomer`.franchise_name IS NOT NULL\n GROUP BY `tabCustomer`.franchise_name\n LIMIT 100000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise(site) Wise Customers",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "mlltkt3lft",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.0,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"SKUs\",\n   \"column\": \"item_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"SKUs\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_ADD(`tabSales Invoice`.posting_date, INTERVAL (2 - DAYOFWEEK(`tabSales Invoice`.posting_date)) DAY),' - ',DATE_ADD(`tabSales Invoice`.posting_date, INTERVAL (8 - DAYOFWEEK(`tabSales Invoice`.posting_date)) DAY))\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_ADD(`tabSales Invoice`.posting_date, INTERVAL (2 - DAYOFWEEK(`tabSales Invoice`.posting_date)) DAY),' - ',DATE_ADD(`tabSales Invoice`.posting_date, INTERVAL (8 - DAYOFWEEK(`tabSales Invoice`.posting_date)) DAY))\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"Day\",\n   \"label\": \"Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Datetime\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"Refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_name` , \\\"Refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": null,
  "limit": 500,
  "modified": "2024-06-13 16:39:55.665268",
  "name": "QRY-0023",
  "result_name": "mllvck9to0",
  "results_row_count": -1,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabSales Invoice Item`.item_name AS `SKUs`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       date_format(CONCAT(DATE_ADD(`tabSales Invoice`.posting_date, INTERVAL (2 - DAYOFWEEK(`tabSales Invoice`.posting_date)) DAY),' - ',DATE_ADD(`tabSales Invoice`.posting_date, INTERVAL (8 - DAYOFWEEK(`tabSales Invoice`.posting_date)) DAY)), '%%Y-%%m-%%d 00:00') AS `Week`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n INNER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_name LIKE '%%Refill%%'\n GROUP BY `tabSales Invoice Item`.item_name,\n          `tabCustomer`.type_of_customer,\n          date_format(CONCAT(DATE_ADD(`tabSales Invoice`.posting_date, INTERVAL (2 - DAYOFWEEK(`tabSales Invoice`.posting_date)) DAY),' - ',DATE_ADD(`tabSales Invoice`.posting_date, INTERVAL (8 - DAYOFWEEK(`tabSales Invoice`.posting_date)) DAY)), '%%Y-%%m-%%d 00:00')\n LIMIT 100",
  "status": "Pending Execution",
  "tables": [],
  "title": "Average of refill SKUs per Customer Type(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "obg6avvst5",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.11,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Status\",\n   \"column\": \"status\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Status\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-12 10:44:01.121594",
  "limit": 500,
  "modified": "2024-06-12 12:59:47.035347",
  "name": "QRY-0004",
  "result_name": "obg6dqgo6j",
  "results_row_count": 5,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.status AS `Status`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.status\n LIMIT 100000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Status of Customers",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "ndh0cf4gle",
  "columns": [],
  "data_source": "Query Store",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.019,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Retention Rate Visual Query Franchise Wise(Weekly)\",\n  \"table\": \"QRY-0025\"\n }\n}",
  "last_execution": "2024-06-24 15:44:41.917824",
  "limit": 500,
  "modified": "2024-06-24 13:53:01.719733",
  "name": "QRY-0040",
  "result_name": "ndh15n5m6l",
  "results_row_count": 4,
  "script": null,
  "script_log": null,
  "sql": "SELECT \"QRY-0025\".*\n  FROM \"QRY-0025\" AS \"QRY-0025\"\n LIMIT 100\nOFFSET 0",
  "status": "Execution Successful",
  "tables": [],
  "title": "Query 0040",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "jfoumv2fq5",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.093,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Item Code Name\",\n   \"column\": \"item_code_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Item Code Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refills\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"qty\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      }\n     ],\n     \"function\": \"sum\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"customer\",\n        \"table\": \"tabSales Invoice\"\n       }\n      }\n     ],\n     \"function\": \"distinct_count\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`) / distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"Refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_name` , \\\"Refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-12 11:08:29.276153",
  "limit": 500,
  "modified": "2024-06-19 18:36:08.578939",
  "name": "QRY-0020",
  "result_name": "jfoud2orlr",
  "results_row_count": 12,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabSales Invoice`.company AS `Franchise`,\n       `tabSales Invoice Item`.item_code_name AS `Item Code Name`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n INNER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_name LIKE '%%Refill%%'\n GROUP BY `tabSales Invoice`.company,\n          `tabSales Invoice Item`.item_code_name,\n          `tabCustomer`.type_of_customer\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise SKU Type  of Customer Wise Refill Rate",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "odhromoi41",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.068,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Lead Source\",\n   \"column\": \"lead_source\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Lead Source\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-12 10:44:01.191922",
  "limit": 500,
  "modified": "2024-06-12 12:59:37.426853",
  "name": "QRY-0005",
  "result_name": "odhsj8rucn",
  "results_row_count": 4,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.lead_source AS `Lead Source`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.lead_source\n LIMIT 100000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Lead Source  Wise Customers",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "o8tt3e2mjv",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.076,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"customer_type\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-12 10:44:00.754326",
  "limit": 500,
  "modified": "2024-06-12 11:30:38.990589",
  "name": "QRY-0003",
  "result_name": "o8ttp6pfao",
  "results_row_count": 3,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.type_of_customer\n LIMIT 100000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Type of Customers",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "opsq3bka6r",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.084,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-10 16:43:30.771160",
  "limit": 500,
  "modified": "2024-06-19 16:02:17.717726",
  "name": "QRY-0026",
  "result_name": "opsrktn8g5",
  "results_row_count": 0,
  "script": null,
  "script_log": null,
  "sql": "SELECT lm.company,\n       COUNT(DISTINCT CASE WHEN cm.customer IS NOT NULL THEN cm.customer END) AS \"Customers Who Bought This Month & Last Month\",\n       COUNT(DISTINCT CASE WHEN lm.customer IS NOT NULL THEN lm.customer END) AS \"Customers Who Bought Last Month Only\",\n       CONCAT(ROUND((COUNT(DISTINCT CASE WHEN cm.customer IS NOT NULL THEN cm.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lm.customer IS NOT NULL THEN lm.customer END), 0)) * 100, 2), '%') AS \"Retention Rate\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01'), ' to ', DATE_FORMAT(CURDATE(), '%Y-%m-01')) AS \"Last Month Date Range\",\n       CONCAT(DATE_FORMAT(CURDATE(), '%Y-%m-01'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%Y-%m-01')) AS \"This Month Date Range\"\n  FROM (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01')\n           AND posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')\n       ) AS lm\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01')\n           AND posting_date < DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%Y-%m-01')\n       ) AS cm\n    ON lm.customer = cm.customer\n GROUP BY lm.company",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate SQL Query Franchise Wise",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "m7od054nik",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.0,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 0,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {},\n    \"raw\": \"\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   },\n   \"right_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  }\n ],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": null,
  "limit": 500,
  "modified": "2024-06-24 13:39:13.791834",
  "name": "QRY-0034",
  "result_name": "m7odfo4fb6",
  "results_row_count": -1,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.*\n  FROM `tabCustomer` AS `tabCustomer`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabCustomer`.name = `tabSales Invoice`.customer\n INNER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n LIMIT 100",
  "status": "Pending Execution",
  "tables": [],
  "title": "Retention Rate Visual Query Franchise Wise(Monthly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "o2n0tmltaf",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.084,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"count\",\n   \"alias\": \"Total Customers\",\n   \"column\": \"count\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Total Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"Integer\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 100000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-12 10:44:00.773374",
  "limit": 500,
  "modified": "2024-06-12 12:59:56.484044",
  "name": "QRY-0001",
  "result_name": "o2n17hbd44",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT count(*) AS `Total Customers`\n  FROM `tabCustomer` AS `tabCustomer`\n LIMIT 100000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Total Customer",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "vebekpk0ni",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.064,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise Name\",\n   \"column\": \"franchise_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer With No Referral Company\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"left\": {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"referral_company\",\n         \"table\": \"tabCustomer\"\n        }\n       },\n       \"operator\": \"=\",\n       \"right\": {\n        \"type\": \"String\",\n        \"value\": \"\"\n       },\n       \"type\": \"BinaryExpression\"\n      }\n     ],\n     \"function\": \"count_if\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"count_if(`tabCustomer.referral_company` = \\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer With No Referral Company\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 10000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-06-28 13:27:55.597103",
  "limit": 500,
  "modified": "2024-06-28 13:27:55.692524",
  "name": "QRY-0042",
  "result_name": "vebgkqf5h4",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.franchise_name AS `Franchise Name`,\n       sum(CASE WHEN (`tabCustomer`.referral_company = '') THEN 1 ELSE 0 END) AS `Customer With No Referral Company`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.franchise_name\n LIMIT 10000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer With No Referral Company ",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "j4able2ekr",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.106,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"qty\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      }\n     ],\n     \"function\": \"sum\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"customer\",\n        \"table\": \"tabSales Invoice\"\n       }\n      }\n     ],\n     \"function\": \"distinct_count\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`) / distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"Refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_name`, \\\"Refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-12 11:08:29.128625",
  "limit": 500,
  "modified": "2024-06-19 18:36:15.584824",
  "name": "QRY-0019",
  "result_name": "j4ab31v52u",
  "results_row_count": 3,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabSales Invoice`.company AS `Franchise`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       sum(`tabSales Invoice Item`.qty) AS `Refill`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customers`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n INNER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_name LIKE '%%Refill%%'\n GROUP BY `tabSales Invoice`.company,\n          `tabCustomer`.type_of_customer\n LIMIT 100000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Franchise Type of Customer Wise Refill Rate",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "hi6h1kvrc9",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.103,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"SKUs\",\n   \"column\": \"item_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"SKUs\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Type Of Customer\",\n   \"column\": \"type_of_customer\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Type Of Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refills\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"qty\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      }\n     ],\n     \"function\": \"sum\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"customer\",\n        \"table\": \"tabSales Invoice\"\n       }\n      }\n     ],\n     \"function\": \"distinct_count\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`) / distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {},\n    \"raw\": \"\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"Refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_name` , \\\"Refill\\\")\"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-12 11:08:28.865328",
  "limit": 500,
  "modified": "2024-06-13 14:37:42.397226",
  "name": "QRY-0017",
  "result_name": "hi6hhl9fqr",
  "results_row_count": 12,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabSales Invoice Item`.item_name AS `SKUs`,\n       `tabCustomer`.type_of_customer AS `Type Of Customer`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       count(DISTINCT `tabSales Invoice`.customer) AS `Customer`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n INNER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_name LIKE '%%Refill%%'\n GROUP BY `tabSales Invoice Item`.item_name,\n          `tabCustomer`.type_of_customer\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Average of refill SKUs per Customer Type",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "p5pu971np2",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.095,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Referral Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"left\": {\n       \"arguments\": [\n        {\n         \"left\": {\n          \"type\": \"Column\",\n          \"value\": {\n           \"column\": \"lead_source\",\n           \"table\": \"tabCustomer\"\n          }\n         },\n         \"operator\": \"=\",\n         \"right\": {\n          \"type\": \"String\",\n          \"value\": \"Customer Referral\"\n         },\n         \"type\": \"BinaryExpression\"\n        }\n       ],\n       \"function\": \"count_if\",\n       \"type\": \"CallExpression\"\n      },\n      \"operator\": \"/\",\n      \"right\": {\n       \"arguments\": [\n        {\n         \"type\": \"Column\",\n         \"value\": {\n          \"column\": \"lead_source\",\n          \"table\": \"tabCustomer\"\n         }\n        }\n       ],\n       \"function\": \"count\",\n       \"type\": \"CallExpression\"\n      },\n      \"type\": \"BinaryExpression\"\n     },\n     \"operator\": \"*\",\n     \"right\": {\n      \"type\": \"Number\",\n      \"value\": 100\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"(count_if(`tabCustomer.lead_source` = \\\"Customer Referral\\\")/ count(`tabCustomer.lead_source`)) * 100\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Referral Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {},\n   \"operator\": {\n    \"label\": null,\n    \"value\": null\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [],\n \"limit\": 100000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-12 10:44:00.698680",
  "limit": 500,
  "modified": "2024-08-12 10:13:52.720914",
  "name": "QRY-0008",
  "result_name": "p5q0lqsp3g",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT (sum(CASE WHEN (`tabCustomer`.lead_source = 'Customer Referral') THEN 1 ELSE 0 END) / count(*)) * 100 AS `Referral Rate`\n  FROM `tabCustomer` AS `tabCustomer`\n LIMIT 100000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer Referral Rate",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "0lfe33trkm",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.094,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"customer\",\n        \"table\": \"tabSales Invoice\"\n       }\n      }\n     ],\n     \"function\": \"distinct_count\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"sum\",\n   \"alias\": \"Refills\",\n   \"column\": \"qty\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refills\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabSales Invoice Item\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Refill Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"left\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"qty\",\n         \"table\": \"tabSales Invoice Item\"\n        }\n       }\n      ],\n      \"function\": \"sum\",\n      \"type\": \"CallExpression\"\n     },\n     \"operator\": \"/\",\n     \"right\": {\n      \"arguments\": [\n       {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"customer\",\n         \"table\": \"tabSales Invoice\"\n        }\n       }\n      ],\n      \"function\": \"distinct_count\",\n      \"type\": \"CallExpression\"\n     },\n     \"type\": \"BinaryExpression\"\n    },\n    \"raw\": \"sum(`tabSales Invoice Item.qty`) / distinct_count(`tabSales Invoice.customer`)\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Refill Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {},\n    \"raw\": \"\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [\n  {\n   \"column\": {\n    \"aggregation\": \"\",\n    \"alias\": \"\",\n    \"column\": \"\",\n    \"expression\": {},\n    \"format\": {},\n    \"granularity\": \"\",\n    \"label\": \"\",\n    \"meta\": null,\n    \"order\": \"\",\n    \"table\": \"\",\n    \"type\": \"String\"\n   },\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"item_name\",\n        \"table\": \"tabSales Invoice Item\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"Refill\"\n      }\n     ],\n     \"function\": \"contains\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"contains(`tabSales Invoice Item.item_name`, \\\"Refill\\\") \"\n   },\n   \"operator\": {\n    \"label\": \"equals\",\n    \"value\": \"=\"\n   },\n   \"value\": {\n    \"label\": null,\n    \"value\": null\n   }\n  }\n ],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-12 11:08:28.462749",
  "limit": 500,
  "modified": "2024-06-13 14:34:57.667010",
  "name": "QRY-0016",
  "result_name": "0lfeib0qrv",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT count(DISTINCT `tabSales Invoice`.customer) AS `Customers`,\n       sum(`tabSales Invoice Item`.qty) AS `Refills`,\n       sum(`tabSales Invoice Item`.qty) / count(DISTINCT `tabSales Invoice`.customer) AS `Refill Rate`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n INNER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n INNER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n WHERE `tabSales Invoice Item`.item_name LIKE '%%Refill%%'\n LIMIT 100000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Refill Rate Metrics",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "g55cfn2q76",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.144,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-10 13:49:08.895152",
  "limit": 500,
  "modified": "2024-06-14 14:16:29.420486",
  "name": "QRY-0030",
  "result_name": "g55d4u8mmu",
  "results_row_count": 4,
  "script": null,
  "script_log": null,
  "sql": "SELECT c.referral_company AS \"Franchise\",\n       c.type_of_customer AS \"Type of Customer\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y')) AS \"Last Two Week\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y')) AS \"This Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought This Week & Last Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Week Only\",\n       CONCAT(ROUND(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0) * 100, 2), '%') AS \"Retention Rate\"\n  FROM (\n        SELECT DISTINCT name,\n               type_of_customer,\n               referral_company\n          FROM `tabCustomer`\n       ) AS c\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY\n           AND posting_date < CURDATE() - INTERVAL WEEKDAY(CURDATE()) + 8 DAY\n       ) AS lw\n    ON c.name = lw.customer\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY\n           AND posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON c.name = tw.customer\n GROUP BY c.referral_company,\n          c.type_of_customer",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate SQL Query Franchise  & Type of Customer Wise(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "vjdg82pdjt",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.05,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Franchise Name\",\n   \"column\": \"franchise_name\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Id\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"left\": {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"referral_company\",\n         \"table\": \"tabCustomer\"\n        }\n       },\n       \"operator\": \"=\",\n       \"right\": {\n        \"type\": \"String\",\n        \"value\": \"\"\n       },\n       \"type\": \"BinaryExpression\"\n      },\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"franchise_doctype_id\",\n        \"table\": \"tabCustomer\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"case\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"case(`tabCustomer.referral_company` = \\\"\\\" , `tabCustomer.franchise_doctype_id`, \\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Id\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Name\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"left\": {\n        \"type\": \"Column\",\n        \"value\": {\n         \"column\": \"referral_company\",\n         \"table\": \"tabCustomer\"\n        }\n       },\n       \"operator\": \"=\",\n       \"right\": {\n        \"type\": \"String\",\n        \"value\": \"\"\n       },\n       \"type\": \"BinaryExpression\"\n      },\n      {\n       \"type\": \"Column\",\n       \"value\": {\n        \"column\": \"customer_name\",\n        \"table\": \"tabCustomer\"\n       }\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"case\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"case(`tabCustomer.referral_company` = \\\"\\\" , `tabCustomer.customer_name`, \\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Name\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"String\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [],\n \"limit\": 10000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-06-28 13:38:04.070393",
  "limit": 500,
  "modified": "2024-06-28 13:38:04.191885",
  "name": "QRY-0043",
  "result_name": "vjdhf40o7p",
  "results_row_count": 4,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.franchise_name AS `Franchise Name`,\n       CASE WHEN (`tabCustomer`.referral_company = '') THEN `tabCustomer`.franchise_doctype_id\n            ELSE ''\n             END AS `Customer Id`,\n       CASE WHEN (`tabCustomer`.referral_company = '') THEN `tabCustomer`.customer_name\n            ELSE ''\n             END AS `Customer Name`\n  FROM `tabCustomer` AS `tabCustomer`\n GROUP BY `tabCustomer`.franchise_name,\n          CASE WHEN (`tabCustomer`.referral_company = '') THEN `tabCustomer`.franchise_doctype_id\n               ELSE ''\n                END,\n          CASE WHEN (`tabCustomer`.referral_company = '') THEN `tabCustomer`.customer_name\n               ELSE ''\n                END\n LIMIT 10000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Customer List With No Referral Company",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "ps8thnvlon",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.139,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-10 13:04:03.937286",
  "limit": 500,
  "modified": "2024-06-19 12:58:01.678133",
  "name": "QRY-0028",
  "result_name": "ps8u9umqic",
  "results_row_count": 2,
  "script": null,
  "script_log": null,
  "sql": "SELECT c.referral_company AS \"Franchise\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y')) AS \"Last Two Week\",\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y')) AS \"This Two Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought This Week & Last Week\",\n       COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END) AS \"Customers Who Bought Last Week Only\",\n       CONCAT(ROUND(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL AND tw.customer IS NOT NULL THEN lw.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lw.customer IS NOT NULL THEN lw.customer END), 0) * 100, 2), '%') AS \"Retention Rate\"\n  FROM (\n        SELECT DISTINCT name,\n               referral_company\n          FROM `tabCustomer`\n       ) AS c\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY\n           AND posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY\n       ) AS lw\n    ON c.name = lw.customer\n  LEFT JOIN (\n        SELECT DISTINCT customer,\n               company\n          FROM `tabSales Invoice`\n         WHERE posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY\n           AND posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY\n       ) AS tw\n    ON c.name = tw.customer\n GROUP BY c.referral_company",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate SQL Query Franchise Wise(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "qq7ma091sm",
  "columns": [],
  "data_source": "Master POS Database",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.915,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 0,
  "is_native_query": 1,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{}",
  "last_execution": "2024-08-10 12:33:33.918567",
  "limit": 500,
  "modified": "2024-08-10 16:43:30.993804",
  "name": "QRY-0010",
  "result_name": "qq7mg5g80j",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT COUNT(DISTINCT CASE WHEN cm.customer IS NOT NULL THEN cm.customer END) AS \"Customers Who Bought This Month & Last Month\",\n       COUNT(DISTINCT CASE WHEN lm.customer IS NOT NULL THEN lm.customer END) AS \"Customers Who Bought Last Month Only\",\n       CONCAT(ROUND((COUNT(DISTINCT CASE WHEN cm.customer IS NOT NULL THEN cm.customer END) / NULLIF(COUNT(DISTINCT CASE WHEN lm.customer IS NOT NULL THEN lm.customer END), 0)) * 100, 2), '%') AS \"Retention Rate\"\n  FROM (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01')\n           AND posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')\n       ) AS lm\n  LEFT JOIN (\n        SELECT DISTINCT customer\n          FROM `tabSales Invoice`\n         WHERE posting_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01')\n           AND posting_date < DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%Y-%m-01')\n       ) AS cm\n    ON lm.customer = cm.customer",
  "status": "Execution Failed",
  "tables": [],
  "title": "Global Retention Rate SQL Query",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "vao22rkieg",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.3,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought Last Month Only\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01') AND  `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')  THEN `tabSales Invoice`.customer  END), 0) AS 'Customers Who Bought Last Month Only'\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01') AND  `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')  THEN `tabSales Invoice`.customer  END), 0) AS 'Customers Who Bought Last Month Only'\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought Last Month Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Month & Last Month\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%Y-%m-01') THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Month & Last Month'\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%Y-%m-01') THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Month & Last Month'\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Month & Last Month\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%Y-%m-01') THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')) THEN `tabSales Invoice`.customer END), 0)/IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01') AND  `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')  THEN `tabSales Invoice`.customer  END), 0)* 100, 2), '%')\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE(), '%Y-%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%Y-%m-01') THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')) THEN `tabSales Invoice`.customer END), 0)/IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%Y-%m-01') AND  `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%Y-%m-01')  THEN `tabSales Invoice`.customer  END), 0)* 100, 2), '%')\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   },\n   \"right_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Inner Join\",\n    \"value\": \"inner\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  }\n ],\n \"limit\": 10000,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-06-20 10:34:49.392709",
  "limit": 500,
  "modified": "2024-06-20 10:34:49.561974",
  "name": "QRY-0015",
  "result_name": "vao2hq3qgl",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%%Y-%%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%%Y-%%m-01') THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought Last Month Only',\n       IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE(), '%%Y-%%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%%Y-%%m-01') THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%%Y-%%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%%Y-%%m-01')) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Month & Last Month',\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE(), '%%Y-%%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE() + INTERVAL 1 MONTH, '%%Y-%%m-01') THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%%Y-%%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%%Y-%%m-01')) THEN `tabSales Invoice`.customer END), 0)/IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date >= DATE_FORMAT(CURDATE() - INTERVAL 1 MONTH, '%%Y-%%m-01') AND `tabSales Invoice`.posting_date < DATE_FORMAT(CURDATE(), '%%Y-%%m-01') THEN `tabSales Invoice`.customer END), 0)* 100, 2), '%%')\n  FROM `tabCustomer` AS `tabCustomer`\n INNER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabCustomer`.name = `tabSales Invoice`.customer\n INNER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n LIMIT 10000",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate Visual Query(Monthly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "it8qts8bmr",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.176,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 0,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Week & Last Week'\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Week & Last Week'\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought Last Week Only\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY   THEN `tabSales Invoice`.customer  END), 0) AS 'Customers Who Bought Last Week Only'\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY   THEN `tabSales Invoice`.customer  END), 0) AS 'Customers Who Bought Last Week Only'\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0)/ IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY   THEN `tabSales Invoice`.customer  END), 0)* 100, 2), '%') AS 'Retention Rate'\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0)/ IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY   THEN `tabSales Invoice`.customer  END), 0)* 100, 2), '%') AS 'Retention Rate'\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   },\n   \"right_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  }\n ],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Customer\",\n  \"table\": \"tabCustomer\"\n }\n}",
  "last_execution": "2024-08-10 13:49:39.182831",
  "limit": 500,
  "modified": "2024-06-20 10:24:42.128971",
  "name": "QRY-0033",
  "result_name": "it8rctre35",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Week & Last Week',\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought Last Week Only',\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0)/ IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY THEN `tabSales Invoice`.customer END), 0)* 100, 2), '%%') AS 'Retention Rate'\n  FROM `tabCustomer` AS `tabCustomer`\n  LEFT OUTER JOIN `tabSales Invoice` AS `tabSales Invoice`\n    ON `tabCustomer`.name = `tabSales Invoice`.customer\n  LEFT OUTER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Global Retention Rate Visual  Query(Weekly)",
  "transforms": [],
  "variables": []
 },
 {
  "chart": "o7f4jgf80l",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.298,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 1,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Last Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'))\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'))\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Last Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"This Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y'))\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y'))\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"This Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Who Bought Last Week Only\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY   THEN `tabSales Invoice`.customer  END), 0) AS 'Customers Who Bought Last Week Only'\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY   THEN `tabSales Invoice`.customer  END), 0) AS 'Customers Who Bought Last Week Only'\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Week & Last Week'\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Week & Last Week'\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS 'Retention Rate'\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS 'Retention Rate'\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-08-10 13:49:39.165011",
  "limit": 500,
  "modified": "2024-06-24 16:02:49.681778",
  "name": "QRY-0025",
  "result_name": "o7f4jq8ui0",
  "results_row_count": 1,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Franchise`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%%d-%%m-%%Y')),\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY, '%%d-%%m-%%Y')),\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought Last Week Only',\n       IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Week & Last Week',\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%%') AS 'Retention Rate'\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n  LEFT OUTER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n  LEFT OUTER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n GROUP BY `tabCustomer`.referral_company,\n          CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%%d-%%m-%%Y')),\n          CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY, '%%d-%%m-%%Y'))\n LIMIT 100",
  "status": "Execution Successful",
  "tables": [],
  "title": "Retention Rate Visual Query Franchise Wise(Weekly)",
  "transforms": [
   {
    "options": "{}",
    "parent": "QRY-0025",
    "parentfield": "transforms",
    "parenttype": "Insights Query",
    "type": ""
   }
  ],
  "variables": []
 },
 {
  "chart": "psh059o3dl",
  "columns": [],
  "data_source": "Site DB",
  "docstatus": 0,
  "doctype": "Insights Query",
  "execution_time": 0.459,
  "filters": "{\n\t\"type\": \"LogicalExpression\",\n\t\"operator\": \"&&\",\n\t\"level\": 1,\n\t\"position\": 1,\n\t\"conditions\": []\n}",
  "is_assisted_query": 1,
  "is_native_query": 0,
  "is_saved_as_table": 1,
  "is_script_query": 0,
  "is_stored": 1,
  "json": "{\n \"calculations\": [],\n \"columns\": [\n  {\n   \"aggregation\": \"group by\",\n   \"alias\": \"Franchise\",\n   \"column\": \"referral_company\",\n   \"expression\": {},\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Franchise\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"tabCustomer\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Last Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'))\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%d-%m-%Y'))\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Last Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"This Two Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y'))\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY, '%d-%m-%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY, '%d-%m-%Y'))\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"This Two Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"String\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customer Who Bought Last Week Only\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY   THEN `tabSales Invoice`.customer  END), 0) AS 'Customers Who Bought Last Week Only'\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND  `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY   THEN `tabSales Invoice`.customer  END), 0) AS 'Customers Who Bought Last Week Only'\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customer Who Bought Last Week Only\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Customers Who Bought This Week & Last Week\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Week & Last Week'\"\n      },\n      {\n       \"type\": \"String\",\n       \"value\": \"\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"\\\"\\\"IFNULL(COUNT( DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Week & Last Week'\\\"\\\"\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Customers Who Bought This Week & Last Week\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Retention Rate\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS 'Retention Rate'\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%') AS 'Retention Rate'\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Retention Rate\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Decimal\"\n  },\n  {\n   \"aggregation\": \"\",\n   \"alias\": \"Test\",\n   \"column\": \"\",\n   \"expression\": {\n    \"ast\": {\n     \"arguments\": [\n      {\n       \"type\": \"String\",\n       \"value\": \"IFNULL( COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date < DATE_SUB(%(filters_date)s, INTERVAL (WEEKDAY(%(filters_date)s) + 8) DAY)    AND `tabSales Invoice`.posting_date >= DATE_SUB(%(filters_date)s, INTERVAL (WEEKDAY(%(filters_date)s) + 21) DAY)   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Week Only`\"\n      }\n     ],\n     \"function\": \"sql\",\n     \"type\": \"CallExpression\"\n    },\n    \"raw\": \"sql(\\\"IFNULL( COUNT(DISTINCT CASE  WHEN `tabSales Invoice`.posting_date < DATE_SUB(%(filters_date)s, INTERVAL (WEEKDAY(%(filters_date)s) + 8) DAY)    AND `tabSales Invoice`.posting_date >= DATE_SUB(%(filters_date)s, INTERVAL (WEEKDAY(%(filters_date)s) + 21) DAY)   THEN `tabSales Invoice`.customer  END), 0) AS `Customers Who Bought Last Week Only`\\\")\"\n   },\n   \"format\": {},\n   \"granularity\": \"\",\n   \"label\": \"Test\",\n   \"meta\": null,\n   \"order\": \"\",\n   \"table\": \"\",\n   \"type\": \"Integer\"\n  }\n ],\n \"dimensions\": [],\n \"filters\": [],\n \"joins\": [\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"name\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"parent\",\n    \"label\": \"parent\",\n    \"table\": \"tabSales Invoice Item\",\n    \"value\": \"parent\"\n   },\n   \"right_table\": {\n    \"label\": \"Sales Invoice Item\",\n    \"table\": \"tabSales Invoice Item\"\n   }\n  },\n  {\n   \"join_type\": {\n    \"label\": \"Left Join\",\n    \"value\": \"left\"\n   },\n   \"left_column\": {\n    \"column\": \"customer\",\n    \"label\": \"customer\",\n    \"table\": \"tabSales Invoice\",\n    \"value\": \"customer\"\n   },\n   \"left_table\": {\n    \"label\": \"Sales Invoice\",\n    \"table\": \"tabSales Invoice\"\n   },\n   \"right_column\": {\n    \"column\": \"name\",\n    \"label\": \"name\",\n    \"table\": \"tabCustomer\",\n    \"value\": \"name\"\n   },\n   \"right_table\": {\n    \"label\": \"Customer\",\n    \"table\": \"tabCustomer\"\n   }\n  }\n ],\n \"limit\": 100,\n \"measures\": [],\n \"orders\": [],\n \"table\": {\n  \"label\": \"Sales Invoice\",\n  \"table\": \"tabSales Invoice\"\n }\n}",
  "last_execution": "2024-06-24 16:27:14.563908",
  "limit": 500,
  "modified": "2024-06-24 18:23:39.271746",
  "name": "QRY-0041",
  "result_name": "psh1esju61",
  "results_row_count": -1,
  "script": null,
  "script_log": null,
  "sql": "SELECT `tabCustomer`.referral_company AS `Franchise`,\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%%d-%%m-%%Y')),\n       CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY, '%%d-%%m-%%Y')),\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought Last Week Only',\n       IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) AS 'Customers Who Bought This Week & Last Week',\n       CONCAT(ROUND(IFNULL(COUNT(DISTINCT CASE WHEN (CASE WHEN `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY AND `tabSales Invoice`.posting_date < CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY THEN `tabSales Invoice`.customer END) IN (SELECT DISTINCT `tabSales Invoice`.customer FROM `tabSales Invoice` WHERE `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) / IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY AND `tabSales Invoice`.posting_date >= CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY THEN `tabSales Invoice`.customer END), 0) * 100, 2), '%%') AS 'Retention Rate',\n       IFNULL(COUNT(DISTINCT CASE WHEN `tabSales Invoice`.posting_date < DATE_SUB(%%(filters_date)s, INTERVAL (WEEKDAY(%%(filters_date)s) + 8) DAY) AND `tabSales Invoice`.posting_date >= DATE_SUB(%%(filters_date)s, INTERVAL (WEEKDAY(%%(filters_date)s) + 21) DAY) THEN `tabSales Invoice`.customer END), 0) AS `Customers Who Bought Last Week Only`\n  FROM `tabSales Invoice` AS `tabSales Invoice`\n  LEFT OUTER JOIN `tabSales Invoice Item` AS `tabSales Invoice Item`\n    ON `tabSales Invoice`.name = `tabSales Invoice Item`.parent\n  LEFT OUTER JOIN `tabCustomer` AS `tabCustomer`\n    ON `tabSales Invoice`.customer = `tabCustomer`.name\n GROUP BY `tabCustomer`.referral_company,\n          CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 21) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 8) DAY, '%%d-%%m-%%Y')),\n          CONCAT(DATE_FORMAT(CURDATE() - INTERVAL (WEEKDAY(CURDATE()) + 7) DAY, '%%d-%%m-%%Y'), ' to ', DATE_FORMAT(CURDATE() + INTERVAL (6 - WEEKDAY(CURDATE())) DAY, '%%d-%%m-%%Y'))\n LIMIT 100",
  "status": "Execution Failed",
  "tables": [],
  "title": "Retention Rate Visual Query Franchise Wise(Weekly)2",
  "transforms": [
   {
    "options": "{}",
    "parent": "QRY-0041",
    "parentfield": "transforms",
    "parenttype": "Insights Query",
    "type": ""
   }
  ],
  "variables": []
 }
]